# 외부 접속 테스트 가이드

## 1. 서버 실행

먼저 라즈베리파이에서 서버를 실행합니다:

```bash
python3 main.py
```

## 2. 외부 접속을 위한 설정

### A. 방화벽 설정 (라즈베리파이)

```bash
# UFW 방화벽 사용 시
sudo ufw allow 8080

# 또는 iptables 사용 시
sudo iptables -A INPUT -p tcp --dport 8080 -j ACCEPT
```

### B. 라즈베리파이 IP 확인

```bash
# 라즈베리파이에서 IP 확인
hostname -I
# 또는
ip addr show
```

### C. 라우터 포트포워딩 (필요시)

라즈베리파이가 NAT 뒤에 있는 경우, 라우터에서 포트 8080을 라즈베리파이로 포워딩해야 합니다.

## 3. 테스트 방법

### 방법 1: Python 테스트 클라이언트 (다른 컴퓨터에서)

```bash
# 다른 컴퓨터에서 실행
python3 test_client.py
```

연결 시 서버 URL을 입력하세요: `ws://라즈베리파이IP:8080`

### 방법 2: 웹 브라우저 테스트

1. `websocket_test.html` 파일을 다른 컴퓨터로 복사
2. 웹 브라우저에서 파일 열기
3. "연결" 버튼 클릭
4. 서버 URL 입력: `ws://라즈베리파이IP:8080`

### 방법 3: curl 스크립트 테스트

```bash
# 다른 컴퓨터에서 실행
./test_websocket.sh 라즈베리파이IP 8080
```

### 방법 4: wscat 사용 (Node.js 필요)

```bash
# wscat 설치
npm install -g wscat

# 연결 테스트
wscat -c ws://라즈베리파이IP:8080
```

## 4. 네트워크 진단

### 연결 테스트

```bash
# 포트 연결 테스트
telnet 라즈베리파이IP 8080

# 또는 nc 사용
nc -zv 라즈베리파이IP 8080
```

### 라즈베리파이에서 서버 상태 확인

```bash
# 포트 리스닝 확인
netstat -tlnp | grep 8080

# 프로세스 확인
ps aux | grep python3
```

## 5. 문제 해결

### 연결이 안 되는 경우

1. **방화벽 확인**
   ```bash
   sudo ufw status
   ```

2. **서버 로그 확인**
   ```bash
   tail -f logs/rs_unity_link.log
   ```

3. **네트워크 연결 확인**
   ```bash
   ping 라즈베리파이IP
   ```

4. **포트 스캔**
   ```bash
   nmap -p 8080 라즈베리파이IP
   ```

### 성능 문제

1. **네트워크 대역폭 확인**
   ```bash
   # 라즈베리파이에서
   iftop -i eth0
   ```

2. **CPU/메모리 사용량 확인**
   ```bash
   htop
   ```

## 6. 보안 고려사항

### 프로덕션 환경에서는:

1. **HTTPS/WSS 사용**
   - SSL 인증서 설정
   - WebSocket Secure (WSS) 사용

2. **인증 추가**
   - API 키 또는 토큰 기반 인증
   - 클라이언트 인증서

3. **방화벽 강화**
   - 특정 IP만 허용
   - 포트 스캔 방지

4. **로깅 강화**
   - 접속 로그 기록
   - 이상 접속 탐지

## 7. 예제 테스트 시나리오

### 기본 테스트
1. 서버 실행
2. 클라이언트 연결
3. 스트리밍 시작
4. 데이터 수신 확인
5. 스트리밍 중지

### 성능 테스트
1. 여러 클라이언트 동시 연결
2. 장시간 스트리밍
3. 네트워크 지연 시뮬레이션
4. 메모리 누수 확인

### 안정성 테스트
1. 네트워크 끊김 시뮬레이션
2. 서버 재시작
3. 클라이언트 재연결
4. 예외 상황 처리 